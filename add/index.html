<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Betnix HTML Game Maker</title>
<style>
:root{
  --bg:#0b0f14; --panel:#121821; --panel-2:#0e141c; --text:#eef2f7;
  --muted:#98a2b3; --accent:#4f8cff; --danger:#ff5d5d;
}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:1000px;margin:0 auto;padding:24px;}
h1,h2,h3{margin:0 0 10px 0;}
.card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #1b2330;border-radius:16px;padding:20px;margin-bottom:20px;}
input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #1e2836;background:#0a0f16;color:var(--text);}
button{padding:10px 14px;border-radius:12px;border:none;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;margin-top:10px;}
button:active{transform:translateY(1px);}
.asset-list a{display:block;padding:10px;border:1px solid #1b2330;margin:6px 0;border-radius:12px;color:var(--text);text-decoration:none;}
.asset-list a:hover{background:#0d131b;}
.copy-box{width:100%;height:80px;resize:none;margin-top:10px;padding:10px;border-radius:10px;border:1px solid #1e2836;background:#0a0f16;color:#eef2f7;}
</style>
</head>
<body>
<div class="container">
  <h1>Betnix HTML Game Maker</h1>

  <div class="card">
    <h2>Create a Game Site</h2>
    <label>Name:<input type="text" id="gameName" required></label>
    <label>Description:<textarea id="gameDesc" rows="3"></textarea></label>
    <label>HTML Code:<textarea id="gameCode" rows="8" placeholder="Paste your HTML here" required></textarea></label>
    <button id="createBtn">Generate Data URL</button>
    <p id="status"></p>
  </div>

  <div class="card">
    <h2>Preview / Play</h2>
    <iframe id="previewFrame" style="width:100%;height:400px;border:1px solid #1b2330;border-radius:12px;"></iframe>
    <textarea id="dataUrlBox" class="copy-box" readonly placeholder="Data URL will appear here"></textarea>
  </div>

  <div class="card">
    <h2>All Saved Games</h2>
    <input type="text" id="searchInput" placeholder="Search by name or ID">
    <div class="asset-list" id="assetList"></div>
  </div>
</div>

<script>
const STORE_KEY = "betnix.htmlgames";
function makeId(bytes=6){const arr=new Uint8Array(bytes);crypto.getRandomValues(arr);return Array.from(arr,b=>b.toString(16).padStart(2,"0")).join("").toUpperCase();}
function loadAll(){try{return JSON.parse(localStorage.getItem(STORE_KEY)||"{}")}catch{return{}}}
function saveAll(db){localStorage.setItem(STORE_KEY,JSON.stringify(db))}

function renderList(filter=""){
  const db=loadAll();const container=document.getElementById("assetList");
  container.innerHTML="";
  Object.keys(db).sort((a,b)=>db[b].created-db[a].created).forEach(id=>{
    const a=db[id];
    if(!a.name.toLowerCase().includes(filter.toLowerCase())&&!id.includes(filter)) return;
    const el=document.createElement("a");
    el.href="#"+id;
    el.textContent=a.name+" ("+id+")";
    el.onclick=e=>{e.preventDefault();showGame(id)};
    container.appendChild(el);
  });
}

function showGame(id){
  const db=loadAll();const a=db[id];if(!a)return alert("Game not found");
  document.getElementById("previewFrame").src=a.dataUrl;
  document.getElementById("dataUrlBox").value=a.dataUrl;
}

document.getElementById("createBtn").addEventListener("click",()=>{
  const name=document.getElementById("gameName").value.trim();
  const desc=document.getElementById("gameDesc").value.trim();
  const code=document.getElementById("gameCode").value.trim();
  if(!name||!code)return alert("Name and HTML code are required.");
  const blob=new Blob([code],{type:"text/html"});
  const url=URL.createObjectURL(blob);
  const id=makeId();
  const db=loadAll();
  // Convert Blob to Data URL
  const reader=new FileReader();
  reader.onload=function(e){
    const dataUrl=e.target.result;
    db[id]={id,name,desc,created:Date.now(),dataUrl};
    saveAll(db);
    document.getElementById("status").textContent="Game saved! ID: "+id;
    document.getElementById("gameName").value="";document.getElementById("gameDesc").value="";document.getElementById("gameCode").value="";
    renderList();
    showGame(id);
  };
  reader.readAsDataURL(blob);
});

document.getElementById("searchInput").addEventListener("input",e=>{
  renderList(e.target.value);
});

// Load initial
renderList();
const initHash=location.hash.slice(1);if(initHash)showGame(initHash);
window.addEventListener("hashchange",()=>{const id=location.hash.slice(1);if(id)showGame(id);});
</script>
</body>
</html>
