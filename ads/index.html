<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Betnix Multi-Page Game Maker</title>
<style>
:root{
  --bg:#0b0f14; --panel:#121821; --panel-2:#0e141c; --text:#eef2f7;
  --muted:#98a2b3; --accent:#4f8cff; --danger:#ff5d5d;
}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:1000px;margin:0 auto;padding:24px;}
h1,h2,h3{margin:0 0 10px 0;}
.card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #1b2330;border-radius:16px;padding:20px;margin-bottom:20px;}
input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #1e2836;background:#0a0f16;color:var(--text);}
button{padding:10px 14px;border-radius:12px;border:none;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;margin-top:10px;}
button:active{transform:translateY(1px);}
.page-item{padding:8px;margin:4px 0;border-radius:8px;border:1px solid #1b2330;background:#0c1118;}
.copy-box{width:100%;height:80px;resize:none;margin-top:10px;padding:10px;border-radius:10px;border:1px solid #1e2836;background:#0a0f16;color:#eef2f7;}
.asset-list a{display:block;padding:10px;border:1px solid #1b2330;margin:6px 0;border-radius:12px;color:var(--text);text-decoration:none;}
.asset-list a:hover{background:#0d131b;}
iframe{width:100%;border:1px solid #1b2330;border-radius:12px;margin-top:10px;}
</style>
</head>
<body>
<div class="container">
<h1>Betnix Multi-Page Game Maker</h1>

<div class="card">
<h2>Create Multi-Page Game</h2>
<label>Game Name:<input type="text" id="gameName" required></label>
<label>Description:<textarea id="gameDesc" rows="2"></textarea></label>

<div id="pagesContainer"></div>
<button id="addPageBtn">Add Page</button>
<button id="createBtn">Generate Data URL</button>
<p id="status"></p>
</div>

<div class="card">
<h2>Preview / Play</h2>
<iframe id="previewFrame" style="height:400px;"></iframe>
<textarea id="dataUrlBox" class="copy-box" readonly placeholder="Data URL will appear here"></textarea>
</div>

<div class="card">
<h2>All Saved Games</h2>
<input type="text" id="searchInput" placeholder="Search by name or ID">
<div class="asset-list" id="assetList"></div>
</div>
</div>

<script>
const STORE_KEY="betnix.multigames";

function makeId(bytes=6){const arr=new Uint8Array(bytes);crypto.getRandomValues(arr);return Array.from(arr,b=>b.toString(16).padStart(2,"0")).join("").toUpperCase();}
function loadAll(){try{return JSON.parse(localStorage.getItem(STORE_KEY)||"{}")}catch{return{}}}
function saveAll(db){localStorage.setItem(STORE_KEY,JSON.stringify(db))}

const pagesContainer=document.getElementById("pagesContainer");
function addPage(name="Page1",code=""){const div=document.createElement("div");div.className="page-item";
div.innerHTML=`<label>Page Name:<input type="text" class="pageName" value="${name}"></label>
<label>HTML Code:<textarea class="pageCode" rows="5">${code}</textarea></label>
<button class="removePageBtn">Remove</button>`;pagesContainer.appendChild(div);
div.querySelector(".removePageBtn").onclick=()=>{pagesContainer.removeChild(div);}
}

document.getElementById("addPageBtn").onclick=()=>addPage("Page"+(pagesContainer.children.length+1),"");

document.getElementById("createBtn").onclick=()=>{
  const name=document.getElementById("gameName").value.trim();
  const desc=document.getElementById("gameDesc").value.trim();
  if(!name){alert("Game name required");return;}
  const pages={};
  const pageNames=document.querySelectorAll(".pageName");
  const pageCodes=document.querySelectorAll(".pageCode");
  for(let i=0;i<pageNames.length;i++){pages[pageNames[i].value||"Page"+(i+1)]=pageCodes[i].value;}
  if(Object.keys(pages).length===0){alert("Add at least one page");return;}

  // Create full HTML with router
  const routerHTML=`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${name}</title></head><body>
<div id="content"></div>
<script>
const pages=${JSON.stringify(pages)};
function showPage(p){const c=pages[p]||pages[Object.keys(pages)[0]];document.getElementById("content").innerHTML=c;}
function update(){showPage(location.hash.slice(1));}
window.addEventListener("hashchange",update);update();
</script></body></html>`;
  const blob=new Blob([routerHTML],{type:"text/html"});
  const reader=new FileReader();
  reader.onload=function(e){
    const dataUrl=e.target.result;
    const id=makeId();
    const db=loadAll();
    db[id]={id,name,desc,created:Date.now(),dataUrl};
    saveAll(db);
    document.getElementById("status").textContent="Game saved! ID: "+id;
    renderList();
    showGame(id);
  };
  reader.readAsDataURL(blob);
};

function renderList(filter=""){
  const db=loadAll();const container=document.getElementById("assetList");
  container.innerHTML="";
  Object.keys(db).sort((a,b)=>db[b].created-db[a].created).forEach(id=>{
    const a=db[id];
    if(!a.name.toLowerCase().includes(filter.toLowerCase())&&!id.includes(filter)) return;
    const el=document.createElement("a");
    el.href="#"+id;
    el.textContent=a.name+" ("+id+")";
    el.onclick=e=>{e.preventDefault();showGame(id);}
    container.appendChild(el);
  });
}

function showGame(id){
  const db=loadAll();const a=db[id];if(!a)return alert("Game not found");
  document.getElementById("previewFrame").src=a.dataUrl;
  document.getElementById("dataUrlBox").value=a.dataUrl;
}

document.getElementById("searchInput").addEventListener("input",e=>renderList(e.target.value));
renderList();

const initHash=location.hash.slice(1);if(initHash)showGame(initHash);
window.addEventListener("hashchange",()=>{const id=location.hash.slice(1);if(id)showGame(id);});
</script>
</body>
</html>
